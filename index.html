<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Swiper demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
  <!-- Link Swiper's CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.css" />

  <!-- Demo styles -->
  <style>
    html,
    body {
      position: relative;
      height: 100%;
    }

    body {
      background: #000;
      font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
      font-size: 14px;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    .swiper {
      width: 100%;
      height: 100%;
      margin-left: auto;
      margin-right: auto;
    }

    .swiper-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      z-index: 1;
      display: flex;
      transition-property: transform;
      box-sizing: content-box;
      justify-content: center;
    }

    .swiper-slide-active {
      width: 90vw !important;
      transform: scale(1) !important;
    }

    .swiper-slide-prev {
      transform: scale(0.85) !important;
      width: 100% !important;
      right: -5vw;
    }

    .swiper-slide-next {
      transform: scale(0.85) !important;
      width: 100% !important;
      left: -5vw;
    }

    .swiper-slide {
      text-align: center;
      font-size: 18px;
      background: #444;
      display: flex;
      justify-content: center;
      align-items: center;
      transform: scale(0.85);
      transition: transform 1s ease;
      border-radius: 16px;
      overflow: hidden;
      background-size: cover;
      background-position: center;
      position: relative;
      aspect-ratio: 16 / 9;
    }

    .swiper-slide picture,
    .swiper-slide img {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
      z-index: 1;
    }

    .swiper-slide video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 2;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.35s ease, visibility 0s linear 0.35s;
      pointer-events: none;
      background: transparent;
    }

    .swiper-slide-active video {
      opacity: 1;
      visibility: visible;
      transition: opacity 0.35s ease;
    }

    .swiper-slide-active picture {
    }
  </style>
</head>

<body>
  <!-- Swiper -->
  <div class="swiper mySwiper">
    <div class="swiper-wrapper">

      <div class="swiper-slide slide-1">
        <picture>
          <source srcset="3k-slider-pic.webp" type="image/webp">
          <img src="3k-slider-pic.jpg" alt="3k slider pic">
        </picture>

        <video muted playsinline loop preload="none" data-src="3k-slider-video.mp4" type="video/mp4">
        </video>
      </div>


      <div class="swiper-slide slide-2">
        <picture>
          <source srcset="canvas-slider-pic.webp" type="image/webp">
          <img src="canvas-slider-pic.jpg" alt="canvas slider pic">
        </picture>

        <video muted playsinline loop preload="none" data-src="canvas-slider-video.mp4" type="video/mp4">
        </video>
      </div>

      <div class="swiper-slide slide-3">
        <picture>
          <source srcset="pixel-slider-pic.webp" type="image/webp">
          <img src="pixel-slider-pic.jpg" alt="pixel slider pic">
        </picture>

        <video muted playsinline loop preload="none" data-src="pixel-slider-video.mp4" type="video/mp4">
        </video>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {

      const swiper = new Swiper('.mySwiper', {
        slidesPerView: 3,
        centeredSlides: true,
        initialSlide: 1,
        loop: false,
        allowTouchMove: true,
        grabCursor: true,
        touchStartForceThreshold: 500,
        touchMoveThreshold: 999,
        dragMinThreshold: 100,

        on: {
          init() {
            prepareVideoTemplates(this);
            updateSlidesMedia(this);
          },

          slideChangeTransitionEnd() {
            if (this.activeIndex === 2) {
              rotateSlidesNext(this);
              return;
            }
            if (this.activeIndex === 0) {
              rotateSlidesPrev(this);
              return;
            }
            updateSlidesMedia(this);
          }

        }
      });

      function prepareVideoTemplates(swiper) {
        swiper.slides.forEach(slide => {
          const vid = slide.querySelector('video[data-src]');
          if (!vid) return;
          const t = vid.cloneNode(false);
          t.dataset.src = vid.dataset.src;
          vid.remove();
          slide._videoTemplate = t;
        });
      }

      function createVideoNodeFromTemplate(slide) {
        if (!slide._videoTemplate) return null;
        const v = slide._videoTemplate.cloneNode(false);
        v.muted = true;
        v.playsInline = true;
        v.setAttribute('playsinline', '');
        v.setAttribute('muted', '');
        v.setAttribute('preload', 'none');
        v.style.opacity = '0';
        v.style.visibility = 'hidden';
        v.style.transition = '';
        return v;
      }

      function appendAndPlayVideo(slide) {
        if (slide._liveVideo) {
          tryPlay(slide._liveVideo, slide._liveVideo.dataset.src);
          return;
        }

        const v = createVideoNodeFromTemplate(slide);
        if (!v) return;
        const url = slide._videoTemplate.dataset.src;
        v.dataset.src = url;
        slide.appendChild(v);
        slide._liveVideo = v;

        v.src = url;
        try { v.load(); } catch (e) { }
        v.style.visibility = 'visible';

        const p = v.play();
        if (p !== undefined) {
          p.catch(() => {
            const onCanPlay = () => {
              v.removeEventListener('canplay', onCanPlay);
              v.play().catch(() => { });
            };
            v.addEventListener('canplay', onCanPlay, { once: true });
          });
        }
      }

      function deactivateVideoKeepSrc(video) {
        if (!video) return;
        try { video.pause(); } catch(e) {}
        try { video.currentTime = 0; } catch(e) {}
        video.style.opacity = '0';
        setTimeout(() => video.style.visibility = 'hidden', 360);
      }


      function tryPlay(video, url) {
        if (!video) return;
        if (url && !video.src) {
          video.src = url;
          try { video.load(); } catch (e) { }
        }
        video.style.visibility = 'visible';
        const p = video.play();
        if (p !== undefined) {
          p.catch(() => {
            const onCanPlay = () => {
              video.removeEventListener('canplay', onCanPlay);
              video.play().catch(() => { });
            };
            video.addEventListener('canplay', onCanPlay, { once: true });
          });
        }
      }

      function rotateSlidesNext(swiper) {
        const wrapper = swiper.wrapperEl;
        const slides = Array.from(wrapper.querySelectorAll('.swiper-slide'));
        if (slides.length <= 1) return;

        const first = slides[0];
        wrapper.appendChild(first);

        swiper.update();

        swiper.slideTo(1, 0, false);
        updateSlidesMedia(swiper);
      }

      function rotateSlidesPrev(swiper) {
        const wrapper = swiper.wrapperEl;
        const slides = Array.from(wrapper.querySelectorAll('.swiper-slide'));
        if (slides.length <= 1) return;

        const last = slides[slides.length - 1];
        const first = slides[0];
        wrapper.insertBefore(last, first);

        swiper.update();

        swiper.slideTo(1, 0, false);
        updateSlidesMedia(swiper);
      }


      function updateSlidesMedia(swiper) {
        swiper.slides.forEach(slide => {
          const isActive = slide.classList.contains('swiper-slide-active');

          if (isActive) {
            appendAndPlayVideo(slide);
            if (slide._liveVideo) {
              slide._liveVideo.style.opacity = '1';
              slide._liveVideo.style.visibility = 'visible';
            }
          } 
          
        });
      }

    });
  </script>


</body>

</html>
