<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Swiper demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
  <!-- Link Swiper's CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@12/swiper.min.css" />
<script src="https://unpkg.com/@rive-app/canvas@2.24.0"></script>

  <!-- Demo styles -->
  <style>
    html,
    body {
      position: relative;
      height: 100%;
    }

    body {
      background: #000;
      font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
      font-size: 14px;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    .swiper {
      height: 100%;
      margin-left: auto;
      margin-right: auto;
    }

    .swiper-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      z-index: 1;
      display: flex;
      transition-property: transform;
      box-sizing: content-box;
      justify-content: center;
    }

    .swiper-slide {
      display: flex;
      justify-content: center;
    }

    .swiper-slide .slide-inner {
      text-align: center;
      font-size: 18px;
      background: #444;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 16px;
      overflow: hidden;
      background-size: cover;
      background-position: center;
      position: relative;
      aspect-ratio: 16 / 9;
      transition: transform 0.35s ease;
      will-change: transform;
    }

    .swiper-slide-active {
      transform: scale(1) !important;
      width: 90% !important;
    }

    .swiper-slide-active .slide-inner {
      width: 100% !important;
    }

    .swiper-slide-next,
    .swiper-slide-prev {
      transform: scale(0.85) !important;
    }

    .slide-inner picture,
    .slide-inner img {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
      z-index: 1;
    }

    .slide-inner video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 2;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.35s ease, visibility 0s linear 0.35s;
      pointer-events: none;
      background: transparent;
    }

    .swiper-slide-active .slide-inner video {
      opacity: 1;
      visibility: visible;
      transition: opacity 0.35s ease;
    }

    .overlay {
      display: flex;
      z-index: 3;
      min-width: 100%;
      justify-content: space-between;
      align-self: flex-end;
      text-align: left;
    }

    .overlay-btn {
      display: none;
      cursor: pointer;
    }




    @media screen and (max-width: 992px) {
      .overlay-btn {
        display: block;
      }
      .rive-slider-wrapper {
        display: none;
      }
      .overlay {
        flex-direction: column;
        text-align: center;
      }

      .overlay p {
        display: none;
      }
    }












  </style>
</head>

<body>

  <div style="min-height: 60px; text-align: center; margin: auto; padding: 0px 4vh;">
    <h1>helo titlesss!!!!!!</h1>
  </div>




  <!-- Swiper -->
  <div class="swiper mySwiper">
    <div class="swiper-wrapper">

      <div class="swiper-slide slide-1">
        <div class="slide-inner">
          <div class="overlay">
            <div>
              <h2>Crumb 3K: A Thank You, Animated</h2>
              <p>Milestones usually get fireworks or confetti. Ours got keyframes, motion, and one big fat emoji that says: Thank you.</p>
            </div>
            <div class="overlay-btn" data-href="https://crumb.tv/crumb-3k/">
              <img src="rive_assets/More_003.svg" alt="More">
            </div>

            <div class="rive-slider-wrapper">
                        <canvas class="rive-slider-canvas" data-rive-src="rive_assets/More_003.riv"
                            data-href="https://crumb.tv/crumb-3k/"></canvas>
            </div>
          </div>



          <picture>
            <source srcset="3k-slider-pic.webp" type="image/webp">
            <img src="3k-slider-pic.jpg" alt="3k slider pic">
          </picture>
          <video muted playsinline loop preload="none" data-src="3k-slider-video.mp4" type="video/mp4">
          </video>
        </div>
      </div>


      <div class="swiper-slide slide-2">
        <div class="slide-inner">

          <picture>
            <source srcset="canvas-slider-pic.webp" type="image/webp">
            <img src="canvas-slider-pic.jpg" alt="canvas slider pic">
          </picture>

          <video muted playsinline loop preload="none" data-src="canvas-slider-video.mp4" type="video/mp4">
          </video>
        </div>
      </div>

      <div class="swiper-slide slide-3">
        <div class="slide-inner">

          <picture>
            <source srcset="pixel-slider-pic.webp" type="image/webp">
            <img src="pixel-slider-pic.jpg" alt="pixel slider pic">
          </picture>

          <video muted playsinline loop preload="none" data-src="pixel-slider-video.mp4" type="video/mp4">
          </video>
        </div>
      </div>

    </div>
  </div>

  <div style="min-height: 60px; text-align: center; margin: auto; padding: 0px 4vh;">
    <h1>ispod swipera!</h1>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {

      const swiper = new Swiper('.mySwiper', {
        slidesPerView: 3,
        centeredSlides: true,
        initialSlide: 1,
        loop: false,
        allowTouchMove: true,
        grabCursor: true,
        touchStartForceThreshold: 500,
        touchMoveThreshold: 999,
        dragMinThreshold: 100,

        on: {
          init() {
            prepareVideoTemplates(this);
            updateSlidesMedia(this);
          },

          slideChangeTransitionEnd() {
            if (this.activeIndex === 2) {
              rotateSlidesNext(this);
              return;
            }
            if (this.activeIndex === 0) {
              rotateSlidesPrev(this);
              return;
            }
            updateSlidesMedia(this);
          }

        }
      });

      function prepareVideoTemplates(swiper) {
        swiper.slides.forEach(slide => {
          const vid = slide.querySelector('video[data-src]');
          if (!vid) return;
          const t = vid.cloneNode(false);
          t.dataset.src = vid.dataset.src;
          vid.remove();
          slide._videoTemplate = t;
        });
      }

      function createVideoNodeFromTemplate(slide) {
        if (!slide._videoTemplate) return null;
        const v = slide._videoTemplate.cloneNode(false);
        v.muted = true;
        v.setAttribute('playsinline', '');
        v.setAttribute('muted', '');
        v.defaultMuted = true;
        v.autoplay = true;
        v.setAttribute('webkit-playsinline', '');
        v.preload = 'metadata';
        return v;
      }

      function appendAndPlayVideo(slide) {
        if (slide._liveVideo) {
          tryPlay(slide._liveVideo, slide._liveVideo.dataset.src);
          return;
        }

        const v = createVideoNodeFromTemplate(slide);
        if (!v) return;
        const url = slide._videoTemplate.dataset.src;
        v.dataset.src = url;
        const container = slide.querySelector('.slide-inner') || slide;
        container.appendChild(v);
        slide._liveVideo = v;

        v.src = url;
        try { v.load(); } catch (e) { }

        
/*         v.style.visibility = 'visible';
 */
        const p = v.play();
        if (p !== undefined) {
          p.catch(() => {
            const onCanPlay = () => {
              v.removeEventListener('canplay', onCanPlay);
              v.play().catch(() => { });
            };
            v.addEventListener('canplay', onCanPlay, { once: true });
          });
        }
      }

      function deactivateVideoKeepSrc(video) {
        if (!video) return;
        try { video.pause(); } catch (e) { }
        try { video.currentTime = 0; } catch (e) { }
        video.style.opacity = '0';
        setTimeout(() => video.style.visibility = 'hidden', 360);
      }


      function tryPlay(video, url) {
        if (!video) return;
        if (url && !video.src) {
          video.src = url;
          try { video.load(); } catch (e) { }
        }
        video.style.visibility = 'visible';
        const p = video.play();
        if (p !== undefined) {
          p.catch(() => {
            const onCanPlay = () => {
              video.removeEventListener('canplay', onCanPlay);
              video.play().catch(() => { });
            };
            video.addEventListener('canplay', onCanPlay, { once: ssstrue });
          });
        }
      }

      function rotateSlidesNext(swiper) {
        const wrapper = swiper.wrapperEl;
        const slides = Array.from(wrapper.querySelectorAll('.swiper-slide'));
        if (slides.length <= 1) return;

        const first = slides[0];
        wrapper.appendChild(first);

        swiper.update();

        swiper.slideTo(1, 0, false);
        updateSlidesMedia(swiper);
      }

      function rotateSlidesPrev(swiper) {
        const wrapper = swiper.wrapperEl;
        const slides = Array.from(wrapper.querySelectorAll('.swiper-slide'));
        if (slides.length <= 1) return;

        const last = slides[slides.length - 1];
        const first = slides[0];
        wrapper.insertBefore(last, first);

        swiper.update();

        swiper.slideTo(1, 0, false);
        updateSlidesMedia(swiper);
      }


      function updateSlidesMedia(swiper) {
        swiper.slides.forEach(slide => {
          const isActive = slide.classList.contains('swiper-slide-active');

          if (isActive) {
            appendAndPlayVideo(slide);
            if (slide._liveVideo) {
              slide._liveVideo.style.opacity = '1';
              slide._liveVideo.style.visibility = 'visible';
            }
            else {
              if (slide._liveVideo) {
              deactivateVideoKeepSrc(slide._liveVideo);
              }
            }    
          }

        });
      }

    });
  </script>


  
<script>
    document.querySelectorAll('.rive-slider-canvas').forEach(canvas => {
        const riveSrc = canvas.getAttribute('data-rive-src');
        const clickUrl = canvas.getAttribute('data-href');

        const riveInstance = new rive.Rive({
            src: riveSrc,
            canvas: canvas,
            autoplay: true,
            stateMachines: ["StateMachine"],
            isTouchScrollEnabled: true,
            onLoad: () => {
                riveInstance.resizeDrawingSurfaceToCanvas();
            }
        });

        let isHovering = false;
        function onRiveEvent(riveEvent) {
            if (riveEvent.data.name === "Hover_On") {
                isHovering = true;
                canvas.style.cursor = "pointer";
            } else if (riveEvent.data.name === "Hover_Off") {
                isHovering = false;
                canvas.style.cursor = "default";
            }
        }
        riveInstance.on(rive.EventType.RiveEvent, onRiveEvent);

        canvas.addEventListener("click", function () {
            window.location.href = clickUrl;
        });

        const imgWrapper = canvas.closest('.overlay').querySelector('.image-slider-wrapper');
        if (imgWrapper) {
            imgWrapper.addEventListener("click", function () {
                window.location.href = clickUrl;
            });
        }
    });

    // Resize Rive canvases on window resize
    window.addEventListener("resize", () => {
        document.querySelectorAll('.rive-slider-canvas').forEach(canvas => {
            if (canvas.riveInstance) {
                canvas.riveInstance.resizeDrawingSurfaceToCanvas();
            }
        });
    });
</script>


</body>

</html>
